<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Relational 2 Graph - Metadata &middot; Augusto Darraidou
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53421933-1', 'auto');
  ga('send', 'pageview');

</script>

</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Augusto Darraidou</h1>
      <p class="lead">Proximamente subo algo.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
        <a href="/">Home</a>
      </li>

      

      
      
        
          
        
      
        
          
            <li class="sidebar-nav-item">
              <a href="/about/">About</a>
            </li>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <li class="sidebar-nav-item"><a href="https://github.com/adarraidou">GitHub</a></li>
      <li class="sidebar-nav-item"><a href="https://twitter.com/adarraidou">Twitter</a></li>
    </ul>

    <p>&copy; 2014. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Relational 2 Graph - Metadata</h1>
  <span class="post-date">07 Aug 2014</span>
  <p>Buscando probar un base de datos NoSQL, más precisamente una base de grafos como <a href="http://neo4j.com">Neo4j</a>, me di cuenta que no tenia datos para hacerlo.
En verdad si tenía, podía utilizar <a href="http://docs.neo4j.org/chunked/stable/cypherdoc-movie-database.html">cypher</a> pero quería ver como <em>acomodar</em> una base de datos relacional en este nuevo esquema.
Para esto me propuse <strong>migrar</strong> la base de datos <a href="http://dev.mysql.com/doc/sakila/en/">sakila</a>, pasarla de un esquema relacional a uno de grafos.</p>

<p>Comenzando por las tablas y relaciones para luego continuar con las vistas.</p>

<p>Mientras lo iba realizando me di cuenta que podía generalizar el proceso demanera que sirva para otras bases, no solo sakila.</p>

<p>Al principio queria ver el esquema, como se acomodaba a este paradigma, por lo que <strong>generé</strong> una base de datos en neo4j que contenía como datos la <strong>estructura de la base relacional</strong>, es decir las <strong>tablas</strong>, sus <strong>columnas</strong>, y las <strong>relaciones</strong> entre estas, de esta manera podía ver la metadata de la base relacional en un ambiente de grafos.</p>

<p>Una vez echo esto, <strong>migré los datos</strong> de sakila a neo4j, al principio leyendo los datos utilizando <strong>jdbc</strong> y generando comandos en <strong>cypher</strong> que pegaba en la consola de neo4j. 
Esto funcionó bien hasta que me encontré con las tablas que tenian gran cantidad de registros, ya no me dejaba relizarlo. Entonces creé un proceso que los insertara utilizando <strong>batchInserter</strong>.</p>

<p>En este post voy a migrar la metadata.</p>

<h1 id="de-que-la-va-sakila">¿De que la va <code>Sakila</code>?</h1>

<p><img src="http://dev.mysql.com/doc/workbench/en/images/wb-sakila-eer.png" alt="Sakila model" /></p>

<h2 id="plan">Plan</h2>
<p>Los pasos que tengo que realizar son:</p>

<h3 id="metadata">Metadata</h3>
<p>Analizar la estructura del modelo relacional, el de grafos y sus las similitudes</p>

<ol>
  <li>Entender los patrones básicos de los grafos para poder traducir las tablas y sus relaciones (FK -&gt; PK). </li>
  <li>Migrar la estructura de la base relacional, <strong>no los datos</strong>. para tener un esquema base e ir probando diferentes cosas.</li>
  <li>Ver esta estructura en un gráfico.</li>
</ol>

<h3 id="definir-la-estructura-a-migrar">Definir la estructura a migrar</h3>
<p>En una primera instancia voy a migrar la base completa, por cada tupla genero un nodo, por cada <em>foreign key</em> en una tabla, una relación en la nueva base</p>

<h1 id="paradigms">Paradigms</h1>

<h2 id="rdbms">RDBMS</h2>

<h3 id="sakila-example">Sakila example</h3>
<p>Aca explico de que se trata el modelo de la base de datos de prueba <strong>sakila</strong>, que tiene actores, <code>peliculas</code>, <code>alquileres</code> y como se crean las tablas intermedias, por ejemplo <code>film_has_category</code>.
puedo empezar por hacer un der normal y luego agregarle esas tablas, para señalar que solo estan para adecuar el modelo de datos al modelo de un rdbms.</p>

<table>
  <thead>
    <tr>
      <th>ERD</th>
      <th>Graph Diagram</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/images/plantuml/7c591096c4850e1dbbd670ca1a3daa69.png" /></td>
      <td><img src="/images/plantuml/b8dc3f7c75166a4e6f6a74bf892be793.png" /></td>
    </tr>
  </tbody>
</table>

<h2 id="graph">Graph</h2>

<p><strong>Simplified model</strong></p>

<p><img src="/images/plantuml/088de128a7f4553aa53dae4611576582.png" /></p>

<h2 id="object">Object</h2>

<p>Aqui señalo como es el modelo de <code>ResultSet</code></p>

<p><img src="/images/plantuml/d9e8691d3eaa52eab5d59036d7db2004.png" /></p>

<hr />

<h1 id="generalizacin">Generalización</h1>

<h2 id="model">Model</h2>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>RDBMS</th>
      <th>Java</th>
      <th>Graph</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Tipo</em></td>
      <td>Table</td>
      <td>DBTable</td>
      <td>(node:<code>DBTable</code>)</td>
    </tr>
    <tr>
      <td><em>Name</em></td>
      <td>table.name</td>
      <td>name : <code>String</code></td>
      <td>node.<code>name</code></td>
    </tr>
    <tr>
      <td><em>Metadata</em></td>
      <td>table.meta</td>
      <td>meta: <code>[key:value] getters and setters</code></td>
      <td>node.<code>properties</code></td>
    </tr>
    <tr>
      <td><em>Properties</em></td>
      <td>table.columns</td>
      <td>columnList : <code>List &lt;DBColumn&gt;</code></td>
      <td><code>(node:DBTable)-[:HAS_COLUMN]-(c:DBColumn)</code><br />  <code>return c</code></td>
    </tr>
    <tr>
      <td><em>Relationships</em></td>
      <td>table.fkList</td>
      <td>fkList : <code>List&lt;DBImportedKey&gt;</code></td>
      <td><code>(node:DBTable)-[fk:FK_TYPE]-(node2:DBTable)</code><br />  <code>return fk</code></td>
    </tr>
  </tbody>
</table>

<h2 id="property">Property</h2>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>RDBMS</th>
      <th>Java</th>
      <th>Graph</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Tipo</em></td>
      <td>Column</td>
      <td>DBColumn</td>
      <td>(node:<code>DBColumn</code>)</td>
    </tr>
    <tr>
      <td><em>Name</em></td>
      <td>column.name</td>
      <td>name: <code>String</code></td>
      <td>node.<code>name</code></td>
    </tr>
    <tr>
      <td><em>Metadata</em></td>
      <td>column.meta</td>
      <td>meta: <code>[key:value] getters and setters</code></td>
      <td>node.<code>properties</code></td>
    </tr>
    <tr>
      <td><em>Relationships</em></td>
      <td>column.fkColumn</td>
      <td> </td>
      <td><code>(node:DBColumn)-[fkCol:IS_FK_COL]-(node2:DBColumn)</code><br />  <code>return fkCol</code></td>
    </tr>
  </tbody>
</table>

<h2 id="relationship">Relationship</h2>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>RDBMS</th>
      <th>Graph</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>Tipo</em></td>
      <td>ImportedKey</td>
      <td><code>(t1:DBTable)-[rel:IS_FK_COL]-(t2:DBTable)</code><br /><code>return rel</code></td>
    </tr>
    <tr>
      <td><em>Name</em></td>
      <td>importedKey.fkName</td>
      <td>rel.<code>name</code></td>
    </tr>
    <tr>
      <td><em>Metadata</em></td>
      <td>importedKey.meta</td>
      <td>rel.<code>properties</code></td>
    </tr>
  </tbody>
</table>

<h3 id="optimizar-la-migracin">Optimizar la migración</h3>

<h2 id="section">#</h2>

<h1 id="procesar-jdbc-metadata">Procesar JDBC Metadata</h1>
<p>Que es una base de datos relacional?
Bueno es esto <a href="http://dev.mysql.com/doc/index-other.html">mysql</a>
Para poder leer esta estructura utilizo las apis <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jdbc/">jdbc</a> de java, primero leo de <a href="http://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html">java.sql.ResultSet</a></p>

<h2 id="procesa-jdbc-metadata">Procesa JDBC Metadata</h2>
<p>Carga de objetos
————-</p>

<table>
  <thead>
    <tr>
      <th>Tabla1</th>
      <th>tabla1_has_tabla2</th>
      <th>Tabla2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>film</td>
      <td>film_has_actor</td>
      <td>actor</td>
    </tr>
    <tr>
      <td>film</td>
      <td>film_has_actor</td>
      <td>actor</td>
    </tr>
    <tr>
      <td>film</td>
      <td>film_has_actor</td>
      <td>actor</td>
    </tr>
  </tbody>
</table>

<h1 id="genera-archivos">Genera archivos</h1>
<p>##Archivos Cypher
###JavaBeans
###etc
#BatchImport
##Metadata en Neo4J
##Datos de la base relacional
#Depura relaciones de grafos</p>

<h2 id="hacer-una-diapositiva-para-ver-la-evolucin">Hacer una diapositiva para ver la evolución</h2>

<p><strong>Base level</strong></p>

<p><img src="/images/plantuml/0c3bbe6f0fcd28ca8934068f86fa687b.png" /></p>

<p><strong>Graph</strong></p>

<p><img src="/images/plantuml/39e2971b385c903ea9c02087ad6d6288.png" /></p>




</div>
  
       <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'adarraidougithubio'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/es/2014/08/09/jdbc/">
            Relational 2 Graph - JDBC
            <small>09 Aug 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/es/2014/08/08/jdbc-metadata/">
            JDBC - Metadata
            <small>08 Aug 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/es/2014/08/08/sakila-metadata-graph/">
            Sakila - Metadata
            <small>08 Aug 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
